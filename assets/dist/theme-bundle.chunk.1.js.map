{"version":3,"sources":["webpack:///./assets/js/theme/product.js","webpack:///./assets/js/theme/product/reviews.js","webpack:///./assets/js/theme/common/utils/safe-string.js","webpack:///./assets/js/theme/product/video-gallery.js"],"names":["Product","context","url","window","location","href","$reviewLink","$","$bulkPricingLink","reviewModal","modalFactory","onReady","validator","document","on","indexOf","history","replaceState","title","pathname","collapsibleFactory","this","productDetails","ProductDetails","BCData","product_attributes","setProductVariant","videoGallery","bulkPricingHandler","$reviewForm","classifyForm","length","review","Review","ModalEvents","opened","setupFocusTrap","registerValidation","ariaDescribeReviewInputs","performCheck","areAll","productReviewHandler","$form","find","each","_","input","$input","msgSpanId","attr","siblings","trigger","PageManager","nod","submit","tap","announceInputErrorMessage","$reviewsContent","$collapsible","initLinkBind","injectPaginationLink","collapseReviews","$content","hasClass","CollapsibleEvents","click","hash","$nextLink","$prevLink","add","selector","validate","errorMessage","safeString","reviewRating","reviewSubject","reviewComment","cb","val","forms","email","reviewEmail","str","DOMParser","parseFromString","body","textContent","VideoGallery","$element","$player","$videos","currentVideo","bindEvents","selectNewVideo","e","preventDefault","$target","currentTarget","id","data","$selectedThumb","setMainVideo","setActiveThumb","removeClass","addClass","bind","index","element","$el"],"mappings":"qTAWqBA,E,oBACjB,WAAYC,GAAS,aACjB,cAAMA,IAAN,MACKC,IAAMC,OAAOC,SAASC,KAC3B,EAAKC,YAAcC,EAAE,wCACrB,EAAKC,iBAAmBD,EAAE,yCAC1B,EAAKE,YAAcC,YAAa,sBAAsB,GALrC,E,2GAQrBC,QAAA,WAAU,IAQFC,EARE,OAENL,EAAEM,UAAUC,GAAG,sBAAsB,YACU,IAAvC,EAAKZ,IAAIa,QAAQ,kBAAkE,mBAAhCZ,OAAOa,QAAQC,cAClEd,OAAOa,QAAQC,aAAa,KAAMJ,SAASK,MAAOf,OAAOC,SAASe,aAO1EC,cAEAC,KAAKC,eAAiB,IAAIC,IAAehB,EAAE,gBAAiBc,KAAKpB,QAASE,OAAOqB,OAAOC,oBACxFJ,KAAKC,eAAeI,oBAEpBC,cAEAN,KAAKO,qBAEL,IAAMC,EAAcC,YAAa,qBAEjC,GAA2B,IAAvBD,EAAYE,OAAhB,CAEA,IAAMC,EAAS,IAAIC,IAAOJ,GAE1BtB,EAAEM,UAAUC,GAAGoB,IAAYC,OAAQ,sBAAsB,kBAAM,EAAK1B,YAAY2B,oBAEhF7B,EAAE,QAAQO,GAAG,QAAS,wCAAwC,WAC1DF,EAAYoB,EAAOK,mBAAmB,EAAKpC,SAC3C,EAAKqC,yBAAyBT,MAGlCA,EAAYf,GAAG,UAAU,WACrB,QAAIF,IACAA,EAAU2B,eACH3B,EAAU4B,OAAO,aAMhCnB,KAAKoB,yB,EAGTH,yBAAA,SAAyBI,GACrBA,EAAMC,KAAK,gBAAgBC,MAAK,SAACC,EAAGC,GAChC,IAAMC,EAASxC,EAAEuC,GACXE,EAAeD,EAAOE,KAAK,QAAlB,OAEfF,EAAOG,SAAS,QAAQD,KAAK,KAAMD,GACnCD,EAAOE,KAAK,mBAAoBD,O,EAIxCP,qBAAA,YAC+C,IAAvCpB,KAAKnB,IAAIa,QAAQ,kBACjBM,KAAKf,YAAY6C,QAAQ,U,EAIjCvB,mBAAA,YAC+C,IAAvCP,KAAKnB,IAAIa,QAAQ,kBACjBM,KAAKb,iBAAiB2C,QAAQ,U,GAxELC,M,mDCXrC,6F,aAOI,WAAYvB,GACRR,KAAKT,UAAYyC,YAAI,CACjBC,OAAQzB,EAAYc,KAAK,wBACzBY,IAAKC,MAGTnC,KAAKoC,gBAAkBlD,EAAE,oBACzBc,KAAKqC,aAAenD,EAAE,qBAAsBc,KAAKoC,iBAEjDpC,KAAKsC,eACLtC,KAAKuC,uBACLvC,KAAKwC,kB,2BAOTF,aAAA,WAAe,WACLG,EAAWvD,EAAE,0BAA2Bc,KAAKoC,iBAEnDlD,EAAE,uBAAuBO,GAAG,SAAS,WACjCP,EAAE,8BAA8B4C,QAAQ,SACnCW,EAASC,SAAS,YACnB,EAAKL,aAAaP,QAAQa,IAAkBC,W,EAKxDJ,gBAAA,WAEQ1D,OAAOC,SAAS8D,MAA6D,IAArD/D,OAAOC,SAAS8D,KAAKnD,QAAQ,qBAKzDM,KAAKqC,aAAaP,QAAQa,IAAkBC,Q,EAMhDL,qBAAA,WACI,IAAMO,EAAY5D,EAAE,0CAA2Cc,KAAKoC,iBAC9DW,EAAY7D,EAAE,8CAA+Cc,KAAKoC,iBAEpEU,EAAUpC,QACVoC,EAAUlB,KAAK,OAAWkB,EAAUlB,KAAK,QAAzC,qBAGAmB,EAAUrC,QACVqC,EAAUnB,KAAK,OAAWmB,EAAUnB,KAAK,QAAzC,sB,EAIRZ,mBAAA,SAAmBpC,GAuBf,OAtBAoB,KAAKpB,QAAUA,EACfoB,KAAKT,UAAUyD,IAAI,CAAC,CAChBC,SAAU,qBACVC,SAAU,WACVC,aAAcC,YAAWpD,KAAKpB,QAAQyE,eACvC,CACCJ,SAAU,oBACVC,SAAU,WACVC,aAAcC,YAAWpD,KAAKpB,QAAQ0E,gBACvC,CACCL,SAAU,mBACVC,SAAU,WACVC,aAAcC,YAAWpD,KAAKpB,QAAQ2E,gBACvC,CACCN,SAAU,mCACVC,SAAU,SAACM,EAAIC,GAEXD,EADeE,IAAMC,MAAMF,KAG/BN,aAAcnD,KAAKpB,QAAQgF,eAGxB5D,KAAKT,W,EAGhB2D,SAAA,WACI,OAAOlD,KAAKT,UAAU2B,gB,yDCzF9B,kCAKO,IAAMkC,EAAa,SAACS,GAEvB,OADU,IAAIC,WACLC,gBAAgBF,EAAK,aAAaG,KAAKC,c,kCCPpD,8CAAO,IAAMC,EAAb,WACI,WAAYC,GACRnE,KAAKoE,QAAUD,EAAS7C,KAAK,uBAC7BtB,KAAKqE,QAAUF,EAAS7C,KAAK,qBAC7BtB,KAAKsE,aAAe,GACpBtE,KAAKuE,aALb,2BAQIC,eAAA,SAAeC,GACXA,EAAEC,iBAEF,IAAMC,EAAUzF,EAAEuF,EAAEG,eAEpB5E,KAAKsE,aAAe,CAChBO,GAAIF,EAAQG,KAAK,WACjBC,eAAgBJ,GAGpB3E,KAAKgF,eACLhF,KAAKiF,kBAnBb,EAsBID,aAAA,WACIhF,KAAKoE,QAAQxC,KAAK,MAAlB,2BAAoD5B,KAAKsE,aAAaO,KAvB9E,EA0BII,eAAA,WACIjF,KAAKqE,QAAQa,YAAY,aACzBlF,KAAKsE,aAAaS,eAAeI,SAAS,cA5BlD,EA+BIZ,WAAA,WACIvE,KAAKqE,QAAQ5E,GAAG,QAASO,KAAKwE,eAAeY,KAAKpF,QAhC1D,KAoCe,SAASM,IAEEpB,EAAE,wBAEVqC,MAAK,SAAC8D,EAAOC,GACvB,IAAMC,EAAMrG,EAAEoG,GACQC,EAAIT,KALZ,2BAKuCZ,GAMrDqB,EAAIT,KAXU,gBAWM,IAAIZ,EAAaqB,U","file":"theme-bundle.chunk.1.js","sourcesContent":["/*\n Import all product specific js\n */\nimport PageManager from './page-manager';\nimport Review from './product/reviews';\nimport collapsibleFactory from './common/collapsible';\nimport ProductDetails from './common/product-details';\nimport videoGallery from './product/video-gallery';\nimport { classifyForm } from './common/utils/form-utils';\nimport modalFactory, { ModalEvents } from './global/modal';\n\nexport default class Product extends PageManager {\n    constructor(context) {\n        super(context);\n        this.url = window.location.href;\n        this.$reviewLink = $('[data-reveal-id=\"modal-review-form\"]');\n        this.$bulkPricingLink = $('[data-reveal-id=\"modal-bulk-pricing\"]');\n        this.reviewModal = modalFactory('#modal-review-form')[0];\n    }\n\n    onReady() {\n        // Listen for foundation modal close events to sanitize URL after review.\n        $(document).on('close.fndtn.reveal', () => {\n            if (this.url.indexOf('#write_review') !== -1 && typeof window.history.replaceState === 'function') {\n                window.history.replaceState(null, document.title, window.location.pathname);\n            }\n        });\n\n        let validator;\n\n        // Init collapsible\n        collapsibleFactory();\n\n        this.productDetails = new ProductDetails($('.productView'), this.context, window.BCData.product_attributes);\n        this.productDetails.setProductVariant();\n\n        videoGallery();\n\n        this.bulkPricingHandler();\n\n        const $reviewForm = classifyForm('.writeReview-form');\n\n        if ($reviewForm.length === 0) return;\n\n        const review = new Review($reviewForm);\n\n        $(document).on(ModalEvents.opened, '#modal-review-form', () => this.reviewModal.setupFocusTrap());\n\n        $('body').on('click', '[data-reveal-id=\"modal-review-form\"]', () => {\n            validator = review.registerValidation(this.context);\n            this.ariaDescribeReviewInputs($reviewForm);\n        });\n\n        $reviewForm.on('submit', () => {\n            if (validator) {\n                validator.performCheck();\n                return validator.areAll('valid');\n            }\n\n            return false;\n        });\n\n        this.productReviewHandler();\n    }\n\n    ariaDescribeReviewInputs($form) {\n        $form.find('[data-input]').each((_, input) => {\n            const $input = $(input);\n            const msgSpanId = `${$input.attr('name')}-msg`;\n\n            $input.siblings('span').attr('id', msgSpanId);\n            $input.attr('aria-describedby', msgSpanId);\n        });\n    }\n\n    productReviewHandler() {\n        if (this.url.indexOf('#write_review') !== -1) {\n            this.$reviewLink.trigger('click');\n        }\n    }\n\n    bulkPricingHandler() {\n        if (this.url.indexOf('#bulk_pricing') !== -1) {\n            this.$bulkPricingLink.trigger('click');\n        }\n    }\n}\n","import nod from '../common/nod';\nimport { CollapsibleEvents } from '../common/collapsible';\nimport forms from '../common/models/forms';\nimport { safeString } from '../common/utils/safe-string';\nimport { announceInputErrorMessage } from '../common/utils/form-utils';\n\nexport default class {\n    constructor($reviewForm) {\n        this.validator = nod({\n            submit: $reviewForm.find('input[type=\"submit\"]'),\n            tap: announceInputErrorMessage,\n        });\n\n        this.$reviewsContent = $('#product-reviews');\n        this.$collapsible = $('[data-collapsible]', this.$reviewsContent);\n\n        this.initLinkBind();\n        this.injectPaginationLink();\n        this.collapseReviews();\n    }\n\n    /**\n     * On initial page load, the user clicks on \"(12 Reviews)\" link\n     * The browser jumps to the review page and should expand the reviews section\n     */\n    initLinkBind() {\n        const $content = $('#productReviews-content', this.$reviewsContent);\n\n        $('#productReview_link').on('click', () => {\n            $('.productView-reviewTabLink').trigger('click');\n            if (!$content.hasClass('is-open')) {\n                this.$collapsible.trigger(CollapsibleEvents.click);\n            }\n        });\n    }\n\n    collapseReviews() {\n        // We're in paginating state, do not collapse\n        if (window.location.hash && window.location.hash.indexOf('#product-reviews') === 0) {\n            return;\n        }\n\n        // force collapse on page load\n        this.$collapsible.trigger(CollapsibleEvents.click);\n    }\n\n    /**\n     * Inject ID into the pagination link\n     */\n    injectPaginationLink() {\n        const $nextLink = $('.pagination-item--next .pagination-link', this.$reviewsContent);\n        const $prevLink = $('.pagination-item--previous .pagination-link', this.$reviewsContent);\n\n        if ($nextLink.length) {\n            $nextLink.attr('href', `${$nextLink.attr('href')} #product-reviews`);\n        }\n\n        if ($prevLink.length) {\n            $prevLink.attr('href', `${$prevLink.attr('href')} #product-reviews`);\n        }\n    }\n\n    registerValidation(context) {\n        this.context = context;\n        this.validator.add([{\n            selector: '[name=\"revrating\"]',\n            validate: 'presence',\n            errorMessage: safeString(this.context.reviewRating),\n        }, {\n            selector: '[name=\"revtitle\"]',\n            validate: 'presence',\n            errorMessage: safeString(this.context.reviewSubject),\n        }, {\n            selector: '[name=\"revtext\"]',\n            validate: 'presence',\n            errorMessage: safeString(this.context.reviewComment),\n        }, {\n            selector: '.writeReview-form [name=\"email\"]',\n            validate: (cb, val) => {\n                const result = forms.email(val);\n                cb(result);\n            },\n            errorMessage: this.context.reviewEmail,\n        }]);\n\n        return this.validator;\n    }\n\n    validate() {\n        return this.validator.performCheck();\n    }\n}\n","/**\n * This function parses HTML entities in strings\n * @param str: String\n * @returns String\n*/\nexport const safeString = (str) => {\n    const d = new DOMParser();\n    return d.parseFromString(str, 'text/html').body.textContent;\n};\n","export class VideoGallery {\n    constructor($element) {\n        this.$player = $element.find('[data-video-player]');\n        this.$videos = $element.find('[data-video-item]');\n        this.currentVideo = {};\n        this.bindEvents();\n    }\n\n    selectNewVideo(e) {\n        e.preventDefault();\n\n        const $target = $(e.currentTarget);\n\n        this.currentVideo = {\n            id: $target.data('videoId'),\n            $selectedThumb: $target,\n        };\n\n        this.setMainVideo();\n        this.setActiveThumb();\n    }\n\n    setMainVideo() {\n        this.$player.attr('src', `//www.youtube.com/embed/${this.currentVideo.id}`);\n    }\n\n    setActiveThumb() {\n        this.$videos.removeClass('is-active');\n        this.currentVideo.$selectedThumb.addClass('is-active');\n    }\n\n    bindEvents() {\n        this.$videos.on('click', this.selectNewVideo.bind(this));\n    }\n}\n\nexport default function videoGallery() {\n    const pluginKey = 'video-gallery';\n    const $videoGallery = $(`[data-${pluginKey}]`);\n\n    $videoGallery.each((index, element) => {\n        const $el = $(element);\n        const isInitialized = $el.data(pluginKey) instanceof VideoGallery;\n\n        if (isInitialized) {\n            return;\n        }\n\n        $el.data(pluginKey, new VideoGallery($el));\n    });\n}\n"],"sourceRoot":""}